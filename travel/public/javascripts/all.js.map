{"version":3,"sources":["all.js"],"names":["url","records","zones","currentSelectZone","show_per_page","xhr","XMLHttpRequest","open","onload","readyState","status","res","responseText","json","JSON","parse","result","map","record","Zone","filter","zone","index","arr","indexOf","options","reduce","all","document","querySelector","innerHTML","render","send","addEventListener","e","target","value","tagName","textContent","window","scrollTo","offsetTop","somerecords","lists","cardTemp","Picture1","Name","Opentime","Add","Tel","Ticketinfo","number_of_items","childElementCount","number_of_pages","Math","ceil","pagiLists","i","textnode","querySelectorAll","forEach","a","onclick","preventDefault","changePage","page_num","start_from","end_on","areaLists","children","style","display","li","className","classList","add"],"mappings":"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","file":"all.js","sourcesContent":["let url = 'https://data.kcg.gov.tw/api/action/datastore_search?resource_id=92290ee5-6e61-456f-80c0-249eae2fcc97'\r\n\r\nlet records = []\r\nlet zones = []\r\nlet currentSelectZone = '三民區'\r\n\r\n// 分頁列的資料\r\nlet show_per_page = 4; // 每一個分頁要顯示的數量\r\n\r\n// 初始化: 頁面載入時就啟動 AJAX、載入選擇清單、使用渲染\r\nlet xhr = new XMLHttpRequest()\r\nxhr.open('get', url)\r\nxhr.onload = function () {\r\n  if (xhr.readyState === 4 && xhr.status === 200) {\r\n    let res = xhr.responseText\r\n    let json = JSON.parse(res)\r\n\r\n    // 取得全部記錄\r\n    records = json.result.records\r\n\r\n    // 取得各區清單\r\n    zones = records.map(record => record.Zone)\r\n      .filter((zone, index, arr) => arr.indexOf(zone) === index)\r\n\r\n    // select 選項製作\r\n    let options = zones.reduce((all, zone, index, arr) => {\r\n      return all + `<option value=\"${zone}\">${zone}</option>`\r\n    }, \"\")\r\n    document.querySelector('select').innerHTML = options\r\n\r\n    // 重繪畫面\r\n    render()\r\n\r\n  }\r\n}\r\nxhr.send()\r\n\r\n\r\n// 監聽器: select 切換監聽\r\ndocument.querySelector('select').addEventListener('change', function (e) {\r\n  currentSelectZone = e.target.value // 抓 option 中的值\r\n  render() \r\n})\r\n// 監聽器: button 點擊監聽\r\ndocument.querySelector('.hot').addEventListener('click', function (e) {\r\n  if (e.target.tagName !== 'BUTTON') return\r\n\r\n  currentSelectZone = e.target.textContent\r\n  render()\r\n\r\n  // 視窗移動\r\n  window.scrollTo(0, document.querySelector('.divide').offsetTop);\r\n})\r\n\r\n// 渲染器: 在初始化、監聽器中被使用\r\nfunction render() {\r\n\r\n  // 挑出某區的所有記錄\r\n  let somerecords = records.filter(record => record.Zone === currentSelectZone)\r\n\r\n  // render | area ------------------------------\r\n  let lists = somerecords.reduce((all, record) => {\r\n    let cardTemp = `\r\n    <div class=\"col-md-6 mb-3\">\r\n      <div class=\"card\">\r\n        <div class=\"card-head\">\r\n          <img src=\"${record.Picture1}\" class=\"card-img-top img-cover\" style=\"height: 200px\">\r\n          <div class=\"card-description\">\r\n            <div class=\"h4 mb-0\">${record.Name}</div>\r\n            <div class=\"align-self-end\">${record.Zone}</div>\r\n          </div>\r\n        </div>\r\n        <div class=\"card-body\">\r\n          <p class=\"card-text\">\r\n            <img src=\"./images/icons_clock.png\" alt=\"\">\r\n            ${record.Opentime}\r\n          </p>\r\n          <p class=\"card-text\">\r\n            <img src=\"./images/icons_pin.png\" alt=\"\">\r\n            ${record.Add}\r\n          </p>\r\n          <p class=\"card-text d-flex justify-content-between\">\r\n            <span>\r\n              <img src=\"./images/icons_phone.png\" alt=\"\">        \r\n              ${record.Tel}\r\n            </span>\r\n            <span>\r\n              <img src=\"./images/icons_tag.png\" alt=\"\">\r\n              ${record.Ticketinfo}\r\n            </span>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>`\r\n\r\n    return all + cardTemp\r\n  }, \"\")\r\n  document.querySelector('.area-name').innerHTML = currentSelectZone\r\n  document.querySelector('.area-lists').innerHTML = lists\r\n\r\n  // render | pagination ------------------------------\r\n  show_per_page = show_per_page; // 每一個分頁要顯示的數量\r\n  let number_of_items = document.querySelector('.area-lists').childElementCount;\r\n  var number_of_pages = Math.ceil(number_of_items / show_per_page);\r\n\r\n\r\n  // 頁數顯示：算出 number_of_pages 後就可以新增下方的分頁數列\r\n  var pagiLists = ''\r\n  for (var i = 1; i < number_of_pages + 1; i++) {\r\n    var textnode = `\r\n    <li class=\"page-item\" onclick=\"changePage(${i - 1})\">\r\n      <a class=\"page-link\" href=\"#\">\r\n      ${i}</a>\r\n    </li>`;\r\n    pagiLists += textnode;\r\n  }\r\n  document.querySelector('.pagination').innerHTML = pagiLists\r\n  document.querySelectorAll('.pagination a').forEach( a => {\r\n    a.onclick = (e)=>{e.preventDefault()}\r\n  }) // 取消 anchor 的預設行為\r\n\r\n\r\n  changePage(0)  // 第0頁開始\r\n\r\n}\r\n\r\n// 切換頁: 在渲染器中被使用\r\nfunction changePage(page_num) {\r\n\r\n  // 開始選取的陣列位置：用頁碼乘以每頁顯示數量\r\n  // 結束選取的陣列位置：用開始選取的陣列位置加上每頁顯示數量\r\n  var start_from = page_num * show_per_page; // 頁碼*每頁顯示數量\r\n  var end_on = start_from + show_per_page;  // 開始位置+每頁顯示數量\r\n  let areaLists = document.querySelector('.area-lists').children\r\n  let number_of_items = document.querySelector('.area-lists').childElementCount;\r\n\r\n  for (var i = 0; i < number_of_items; i++) {\r\n    areaLists[i].style.display = 'none'; // 重置\r\n\r\n    if (i >= start_from && i < end_on) {\r\n      areaLists[i].style.display = 'block';\r\n    }\r\n  }\r\n\r\n  document.querySelectorAll('.pagination li').forEach( (li, index) => {\r\n    li.className = 'page-item'\r\n    if (index == page_num) li.classList.add('active')\r\n  })\r\n\r\n}\r\n"]}